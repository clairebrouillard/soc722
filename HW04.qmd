---
title: "Chapter 4 homework"
format: html
embed-resources: true
---

```{r}
#|message: false

library(tidyverse)
library(broom)
library(here)
```

```{r}
fitness <- read_csv(here("data", "fitness.csv"))
```

# Homework questions

## 1. Sampling distributions and statistical surprise

Write brief answers.

- What is a sampling distribution of a statistic (like a mean), and what is it useful for?
- How can a sampling distribution be used to evaluate whether an observed value is “surprising” under a null hypothesis?

## 2. Model comparison test: is the mean resting pulse 72?

Using the Fitness data, evaluate whether the sample of participants is consistent with a population mean of `RSTPULSE = 72` using a **model comparison**.

### 2a. Fit Model C and Model A

Use these models:

- **Model C (null):** the outcome is fixed at 72 with no free parameters  
  $$Y_i = 72 + \varepsilon_i.$$

- **Model A (mean model):** estimate the mean from the data  
  $$Y_i = b_0 + \varepsilon_i.$$

```{r}
fitness <- fitness |>
  mutate(rstpulse_dev = RSTPULSE - 72)

model_c <- lm(rstpulse_dev ~ 0, data = fitness)
model_a <- lm(rstpulse_dev ~ 1, data = fitness)

summary(model_c)
summary(model_a)
# Model C: fixed mean at 72 (no parameters)
# Hint: use lm(... ~ 0) with the outcome shifted by 72
# model_c <- ...

# Model A: estimate the mean (intercept-only model)
# model_a <- ...
```

### 2b. Compute PRE and F

Compute:

$$\text{SSE}(\cdot) = \sum_i e_i^2$$ (use `deviance()` for an `lm` object)

$$\text{PRE} = \frac{\text{SSE}(C) - \text{SSE}(A)}{\text{SSE}(C)}$$

$$F^* = \frac{\text{PRE}/(P_A - P_C)}{(1-\text{PRE})/(n - P_A)}$$

```{r}
sse_c <- deviance(model_c)
sse_a <- deviance (model_a)

pre <- (sse_c - sse_a) / sse_c

pre
n <- fitness |>
  nrow()

pc <- 0
pa <- 1

fstat <- (pre / (pc - pa)) / ((1 - pre) / ( n - 1))
```

### 2c. Identify “surprising” values from the book tables and/or by using `qf()`.

Fill in the quantities the tables depend on:

- number of participants:  n = 31
- number of parameters in Model C:  $P_C$ = 0
- number of parameters in Model A:  $P_A$ = 1
- new parameters:  $P_A - P_C$ = 1
- unused parameters (residual df for Model A):  $n - P_A$ = 30

Then, using the book tables and/or `qf()`:

- critical PRE at $\alpha = .05$:  PREcrit = 0.138
- critical F at $\alpha = .05$:  Fcrit = 4.171

```{r}
df1 <- 1
df2 <- 30
alpha <- .05

# PRE
calc_null_pre <- function() {
  
  null_data <- tibble(rstpulse_dev = rnorm(df2, 0, 72))
  
  m0 <- lm(rstpulse_dev ~ 0, data = null_data)
  m1 <- lm(rstpulse_dev ~ 1, data = null_data)
  
  nullpre <- (deviance(m0) - deviance(m1)) / deviance(m0)
  
  return(nullpre)
}

null_sims <- tibble(sim_number = 1:1000) |>
  rowwise() |>
  mutate(pre = calc_null_pre())

quantile(null_sims$pre, c(.95, .99, 1))

# F
f_obs <- fstat
f_crit <- qf(1 - alpha, df1, df2)
```

### 2d. Conclusions

- Statistical conclusion: Do you reject or retain the null hypothesis at $\alpha = .05$? Explain using the logic of “surprising under the null.”
- Substantive conclusion: Give a one-sentence interpretation in plain language.

## 3. Alternative F formula using SSR and SSE(A)

Let

$$\text{SSR} = \text{SSE}(C) - \text{SSE}(A)$$

$$F^* = \frac{\text{SSR}/(P_A - P_C)}{\text{SSE}(A)/(n - P_A)}$$

### 3a. Compute F using SSR and SSE(A)

```{r}
# ssr <- ...
# f_star_ssr <- ...
```

### 3b–3e. Interpretation

Write brief answers.

- What does the numerator $\text{SSR}/(P_A - P_C)$ represent?
- What does the denominator $\text{SSE}(A)/(n - P_A)$ represent?
- What does $F^*$ represent conceptually?
- Compute $t$ for this $F^*$ (use the relationship between $t$ and $F$ when the numerator df is 1).

```{r}
# t_star <- ...
```

## 4. Does running increase pulse rate?

Using the Fitness dataset, compare `RSTPULSE` (resting pulse) to `RUNPULSE` (post-run pulse).

### 4a. Set up Model C and Model A

Use a model comparison where the null corresponds to **no mean change** from resting to post-run.

One convenient approach:

1. Create a difference score $D_i = \text{RUNPULSE}_i - \text{RSTPULSE}_i$.
2. Compare:
   - **Model C:** $D_i = 0 + \varepsilon_i$ (no free parameters)  
     $$D_i = 0 + \varepsilon_i.$$
   - **Model A:** $D_i = b_0 + \varepsilon_i$ (estimate the mean difference)  
     $$D_i = b_0 + \varepsilon_i.$$

```{r}
# fitness <- fitness |>
#   mutate(d = RUNPULSE - RSTPULSE)

# model_c <- ...
# model_a <- ...
```

### 4b. Compute PRE and F, then compare to critical values

```{r}
# sse_c <- ...
# sse_a <- ...
# pre <- ...
# f_star <- ...
```

From the book tables at $\alpha=.05$:

- PREcrit =
- Fcrit =

### 4c. Conclusions

- Statistical conclusion (reject/retain the null).
- Substantive conclusion (plain-language interpretation).

## 5. With your own data

Return to your own dataset and the model comparison you set up previously. In this section, please use 

### 5a. Fit your models

```{r}

```

### 5b. Report PRE, F\*, and t\*

```{r}

```

### 5c. Use tables or functions to identify critical values and write conclusions

```{r}

```
